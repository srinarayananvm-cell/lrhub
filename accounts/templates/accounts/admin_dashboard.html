{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb bg-light p-2 rounded shadow-sm">
      <li class="breadcrumb-item active" aria-current="page">
        <i class="fas fa-tachometer-alt me-2 text-primary"></i> Admin Dashboard
      </li>
    </ol>
  </nav>

  <h3 class="mb-4">
    <i class="fas fa-users-cog me-2 text-success"></i> Manage Users
  </h3>


  <!-- Search + Actions -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <form method="get" class="input-group w-50">
      <input type="text" name="q" class="form-control" placeholder="ðŸ” Search by username" value="{{ request.GET.q }}">
      <button class="btn btn-outline-primary" type="submit">
        <i class="fas fa-search"></i>
      </button>
    </form>

    <div>
      <a href="{% url 'add_user' %}" class="btn btn-success me-2">
        <i class="fas fa-user-plus"></i> Add User
      </a>
      <a href="{% url 'bulk_import_users' %}" class="btn btn-warning">
        <i class="fas fa-file-import"></i> Bulk Import
      </a>
    </div>
  </div>

  {% if users %}
  <div class="table-responsive shadow-sm">
    <table class="table table-hover align-middle">
      <thead class="table-dark">
        <tr>
          <th><i class="fas fa-user"></i> Username</th>
          <th><i class="fas fa-envelope"></i> Email</th>
          <th><i class="fas fa-id-badge"></i> Role</th>
          <th><i class="fas fa-check-circle"></i> Approved</th>
          <th><i class="fas fa-tools"></i> Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for u in users %}
        <tr>
          <td>{{ u.username }}</td>
          <td>{{ u.email }}</td>
          <td>
            {% if u.profile.role == "teacher" %}
              <span class="badge bg-info text-dark"><i class="fas fa-chalkboard-teacher"></i> Teacher</span>
            {% elif u.profile.role == "student" %}
              <span class="badge bg-primary"><i class="fas fa-user-graduate"></i> Student</span>
            {% else %}
              <span class="badge bg-secondary"><i class="fas fa-user-shield"></i> Admin</span>
            {% endif %}
          </td>
          <td>
            {% if u.profile.role == "teacher" %}
              {% if u.profile.approved %}
                <span class="text-success"><i class="fas fa-check-circle"></i> Approved</span>
              {% else %}
                <span class="text-danger"><i class="fas fa-times-circle"></i> Pending</span>
              {% endif %}
            {% else %}
              <span class="text-muted">â€”</span>
            {% endif %}
          </td>
          <td>
            {% if u.profile.role == "teacher" and not u.profile.approved %}
              <a href="{% url 'approve_teacher' u.id %}" class="btn btn-sm btn-success me-1">
                <i class="fas fa-check"></i> Approve
              </a>
            {% endif %}
            <a href="{% url 'edit_user' u.id %}" class="btn btn-sm btn-primary me-1">
              <i class="fas fa-edit"></i> Edit
            </a>
            <a href="{% url 'delete_user' u.id %}" class="btn btn-sm btn-danger"
               onclick="return confirm('âš ï¸ Are you sure you want to delete {{ u.username }}?');">
              <i class="fas fa-trash"></i> Delete
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
    <div class="alert alert-info shadow-sm">
      <i class="fas fa-info-circle me-2"></i> No users to display. Please search by username.
    </div>
  {% endif %}
</div>
{% endblock %}
