{% extends "base.html" %}
{% block content %}
<div class="container mt-4">

  <!-- Breadcrumbs -->
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <a href="{% url 'collaboration_home' %}">
          <i class="fas fa-users"></i> Collaboration
        </a>
      </li>
      <li class="breadcrumb-item">
        <a href="{% url 'group_detail' post.group.pk %}">
          <i class="fas fa-layer-group"></i> {{ post.group.name }}
        </a>
      </li>
      <li class="breadcrumb-item active" aria-current="page">
        <i class="fas fa-file-alt"></i> {{ post.title }}
      </li>
    </ol>
  </nav>

  <!-- Post Header -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h3 class="card-title">{{ post.title }}</h3>
      <p class="card-text">{{ post.content }}</p>
      <small class="text-muted">
        <i class="fas fa-user"></i> {{ post.author.username }}
        â€¢ <i class="fas fa-clock"></i> {{ post.created_at|date:"M d, Y H:i" }}
      </small>
      {% if post.author == user %}
        <div class="mt-2">
          <a href="{% url 'edit_post' post.pk %}" class="btn btn-sm btn-warning">
            <i class="fas fa-edit"></i> Edit Post
          </a>
          <a href="{% url 'delete_post' post.pk %}" class="btn btn-sm btn-danger">
            <i class="fas fa-trash"></i> Delete Post
          </a>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Comments Toggle Button -->
  <button class="btn btn-secondary mb-3" type="button" data-bs-toggle="collapse" data-bs-target="#commentsSection" aria-expanded="false" aria-controls="commentsSection">
    <i class="fas fa-comments"></i> Comments ({{ comments|length }})
  </button>

  <!-- Collapsible Comments Section -->
    <div class="collapse {% if request.GET.show_comments %}show{% endif %}" id="commentsSection">
    <div class="card card-body">
      <!-- Existing Comments -->
      {% for comment in comments %}
        <div class="card mb-2 shadow-sm">
          <div class="card-body p-2">
            <strong><i class="fas fa-user-circle"></i> 
              {% if comment.author.profile.role == "teacher" %}
                <span class="text-primary fw-bold">{{ comment.author.username }}</span>
              {% elif comment.author.profile.role == "student" %}
                <span class="text-success">{{ comment.author.username }}</span>
              {% else %}
                {{ comment.author.username }}
              {% endif %}
            </strong>: {{ comment.content }}
            <br>
            <small class="text-muted">
              <i class="fas fa-clock"></i> {{ comment.created_at|date:"M d, H:i" }}
            </small>
            {% if comment.author == user %}
              <div class="mt-2">
                <a href="{% url 'edit_comment' comment.pk %}" class="btn btn-sm btn-warning">
                  <i class="fas fa-edit"></i> Edit
                </a>
                <a href="{% url 'delete_comment' comment.pk %}" class="btn btn-sm btn-danger">
                  <i class="fas fa-trash"></i> Delete
                </a>
              </div>
            {% endif %}
          </div>
        </div>
      {% empty %}
        <p class="text-muted"><i class="fas fa-info-circle"></i> No comments yet. Be the first to reply!</p>
      {% endfor %}

      <!-- New Comment Form -->
      <div class="mt-4">
        <h5><i class="fas fa-plus-circle"></i> Add a Comment</h5>
        <form method="post" class="border rounded p-3 bg-light shadow-sm">
          {% csrf_token %}
          {{ comment_form.as_p }}
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-paper-plane"></i> Add Comment
          </button>
        </form>
      </div>

    </div>
  </div>

</div>
{% endblock %}
